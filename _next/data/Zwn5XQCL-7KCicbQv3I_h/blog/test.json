{"pageProps":{"posts":[{"title":"test01","description":"test01 des","icon":"","image":"","tags":["a","b"],"draft":false,"date":"2023-08-21","content":"\n# 참고\n\n![230909-214804](/posts/test01/230909-214804.png)\n\n이 포스트는 개인 블로그 스타일링을 목적으로 아래의 포스트를 사용했습니다.\n\n[bepyan](https://github.com/bepyan/bepyan.github.io/blob/main/posts/blog/nextjs-blog/3-mdx-plugin.mdx)\n\n## 기본 사용법\n\n✨ [**next-mdx-remote**](https://github.com/hashicorp/next-mdx-remote)를 활용하여 markdown파일을 이쁜 HTML 코드로 변환해줍니다.  \n추가로 markdown 파일에서 React 컴포넌트를 사용할 수 있는 이점이 있습니다.\n\n```shell\nyarn add next-mdx-remote\n```\n\n<br />\n\n1. mdx 파일을 `serialize`하여 필요한 데이터를 추출하고 가공합니다.\n\n```ts:libs/mdx.ts\nimport { serialize } from 'next-mdx-remote/serialize';\n\nexport const serializeMdx = (source: string) => {\n  return serialize(source, {\n    mdxOptions: {\n      remarkPlugins: [],\n      rehypePlugins: [],\n      format: 'mdx',\n    },\n  });\n};\n```\n\n- [`remark plugins`](https://github.com/remarkjs/remark/blob/main/doc/plugins.md)과 [`rehype plugins`](https://github.com/rehypejs/rehype/blob/main/doc/plugins.md)를 활용해서 다양한 기능을 추가할 수 있습니다.\n\n<br />\n\n2. `getStaticProps`(빌드시점)에서 필요한 데이터를 모두 가공합니다.\n\n```ts:[...slugs].tsx {21}\nimport { GetStaticPaths, GetStaticProps } from 'next';\nimport { serializeMdx } from '~/libs/mdx';\nimport { getAllPosts } from '~/libs/post';\n\nexport const getStaticPaths: GetStaticPaths = () => {\n  const posts = getAllPosts();\n\n  return {\n    paths: posts.map((post) => `/blog/${post.slug}`),\n    fallback: 'blocking',\n  };\n};\n\nexport const getStaticProps: GetStaticProps = async ({ params }) => {\n  const { slugs } = params as { slugs: string[] };\n\n  const slug = [...slugs].join('/');\n  const post = getAllPosts().find((v) => v.slug === slug);\n  //...\n\n  const mdx = await serializeMdx(post.content);\n\n  return {\n    props: { mdx },\n  };\n};\n```\n\n<br />\n\n3. 브라우저는 `<MDXRemote />`가 마운트되면서 데이터를 HTML로 변환합니다.\n\n```tsx\nexport default function PostPage({ mdx }: { mdx: MDXRemoteSerializeResult }) {\n  return (\n    <div className=\"prose dark:prose-dark mt-4 w-full max-w-none\">\n      <MDXRemote {...mdx} />\n    </div>\n  );\n}\n```\n\n---\n\n## 기본 스타일링\n\n### @tailwindcss/typography\n\nhttps://tailwindcss.com/docs/typography-plugin\n\ntailwind 기반으로 mdx 마크업을 스타일링하는데 기본 설정만 사용해도 충분히 이쁩니다!\n\n```js:tailwind.config.js\nmodule.exports = {\n  theme: {\n    // ...\n  },\n  variants: {\n    typography: ['dark'],\n  },\n  plugins: [require('@tailwindcss/typography')],\n}\n```\n\n마크다운 컴포넌트 상위에 `prose`를 꼭 씌워줘야하는 것을 잊지 않길 바랍니다!\n\n```tsx\n<div className=\"prose dark:prose-dark\">\n  <MDXRemote {...mdx} />\n</div>\n```\n\n`tailwind.config.js`에서 [커스터마이징](https://tailwindcss.com/docs/typography-plugin#customizing-the-css)을 할수도 있고 `globals.css`에서도 스타일을 정의 할 수 있습니다.  \n관심사에 따라 css 코드들을 분리하면 좋은 것 같습니다.\n\n```css:globals.css\n/* ... */\n@import url(./code.css);\n@import url(./prose.css);\n/* ... */\n```\n\n```css:prose.css\n.prose a {\n  @apply transition-all;\n}\n```\n\n---\n\n## 필수 플러그인\n\n변환 도구들은 모두 `server-side`에서 실행 될 것이기에 모두 `devDependency`로 설치해줍니다.\n\n```shell\nyarn add -D remark-gfm rehype-prism-plus rehype-slug rehype-autolink-headings\nyarn add -D @tailwindcss/typography\n```\n\n---\n\n### remark-gfm\n\nhttps://github.com/remarkjs/remark-gfm\n\n`GFM`(autolink literals, footnotes, strikethrough, tables, tasklists...) 문법들을 해석해주는 도구 입니다.\n굉장히 기본적인 마크다운 문법을 HTML로 변환해주기에 필수로 사용해야 합니다.\n\n---\n\n### rehype-prism-plus\n\nhttps://github.com/timlrx/rehype-prism-plus\n\n[**prism**](https://prismjs.com/) 기반으로 코드블럭을 `syntax highlighting`해주는 도구 입니다.  \nhighlighting, showLineNumbers, line inserted, line deleted 등 강력크한 기능을 제공해줍니다.\n\n```diff-js {1} showLineNumbers\nfunction fancyAlert(arg) {\n  if (arg) {\n+    $.facebox({ div: '#foo' })\n-    alert('#roo')\n  }\n}\n```\n\n하지만 코드 토큰만 해석해줄 뿐이지 스타일은 직접 씌워줘야합니다.  \nprism기반의 [**다양한 테마**](https://github.com/PrismJS/prism-themes)를 적용할 수 있으니 취향 것 선택하면 됩니다.  \n추가적으로 [**dracular**](https://draculatheme.com/prism) [**intellij**](https://github.com/bulenkov/Darcula) 테마를 추천드립니다.\n\n자세한 설정은 [제 레포지토리](https://github.com/bepyan/bepyan.github.io/blob/main/src/styles/intellij-prism.css)를 참고해주시면 될 것 같습니다. ~~생각보다 복잡합니다...~~\nvscode와 완벽히 똑같이 스타일링 되지 않는 점은 감안하셔야 합니다.\n\n---\n\n### rehype-slug, rehype-autolink-headings\n\n[**rehype-slug**](https://github.com/rehypejs/rehype-slug)를 사용하여 headings에 id를 심어주면,  \n[**rehype-autolink-headings**](https://github.com/rehypejs/rehype-autolink-headings)가 id를 통해서 anchor를 생성해줍니다.  \n이를 활용하여 제목들로 바로가는 링크가 활성화되며 다양하게 응용될 수 있습니다.\n\n참고로 이전에 많이 사용되었던 [**remark-slug**](https://github.com/remarkjs/remark-slug)는 deprecated 되었습니다.\n\nHeadings Link의 className를 아래와 같이 커스텀하게 지정할 수 있습니다.\n\n```ts:libs/mdx.ts\nimport { serialize } from 'next-mdx-remote/serialize';\nimport rehypeAutolinkHeadings from 'rehype-autolink-headings';\n\nexport const serializeMdx = (source: string) => {\n  return serialize(source, {\n    //...\n    mdxOptions: {\n      //...\n      rehypePlugins: [\n        [\n          rehypeAutolinkHeadings,\n          {\n            properties: {\n              className: ['anchor'],\n            },\n          },\n        ],\n      ],\n    },\n  });\n};\n```\n\n기본적으로 css의 `content`를 활용해서 `anchor`를 만들 수 있습니다.\n\n```css {11}\n.prose .anchor {\n  @apply invisible absolute no-underline;\n\n  margin-left: -1em;\n  padding-right: 0.5em;\n  cursor: pointer;\n}\n\n.prose .anchor:after {\n  @apply text-gray-300 dark:text-gray-700;\n  content: \"#\";\n}\n\n.anchor:hover,\n.prose *:hover > .anchor {\n  @apply visible;\n}\n```\n\n적당히 스크롤되도록 `scroll-margin-top`을 추가해주면 금상첨화입니다.\n\n```js:tailwind.config.js\nconst { spacing } = require('tailwindcss/defaultTheme');\n\nmodule.exports = {\n  //...\n  theme: {\n    extend: {\n      typography: (theme) => ({\n        DEFAULT: {\n          css: {\n            //...\n            'h1,h2,h3,h4': {\n              'scroll-margin-top': spacing[32],\n            },\n          }\n        }\n      })\n    }\n  }\n}\n```\n\n---\n\n### remark-breaks\n\nhttps://github.com/remarkjs/remark-breaks\n\n기존 마크다운 문법에서는 문장 끝에 ` ` 2개 이상 입력해야 줄바꿈이 되는데 개인적으로 꽤나 불편했습니다.\n해당 플러그인을 사용하면 마크다운에서 작성한대로 줄바꿈이 적용됩니다.\n\n---\n\n## 추천 플로그인\n\n필요에 따라 활용도가 높은 플러그인들입니다. ~~어쩌면 필수~~\n\n---\n\n### remark-math, rehype-katex\n\n```shell\nyarn add -D remark-math rehype-katex\n```\n\n[remark-math](https://github.com/remarkjs/remark-math)과 [rehype-katex](https://github.com/remarkjs/remark-math/tree/main/packages/rehype-katex)를 활용하여 mdx에서 수학 수식을 사용할 수 있습니다.\n\n---\n\n### rehype-code-titles\n\nhttps://github.com/josestg/rehype-code-title\n\n코드블럭 제목을 생성해주는 도구입니다.\n\n`확장자:파일명`처럼 사용하면 됩니다. &nbsp; ex. `tsx:pages/_app.tsx`\n\nmdx에서 작성한 것이 아래와 같이 파싱됩니다.\n\n```html\n<div class=\"rehype-code-title\">code.css</div>\n<pre class=\"language-css\">\n  <code class=\"language-css code-highlight\">\n    <span class=\"code-line\">\n      <!-- ... -->\n    </span>\n  </code>\n</pre>\n```\n\n스타일은 역시 직접 작성해줘야 합니다.\n\n```css:code.css\n.prose .rehype-code-title {\n  /* ... */\n  @apply rounded-t-lg border border-b-0 px-5 py-3 text-sm font-bold;\n}\n```\n\n---\n\n### remark-toc\n\nhttps://github.com/remarkjs/remark-toc\n\n`Tabel of Content`를 만들어 주는 도구 입니다.\n\n보통 최상단에 `## TOC` 혹은 `## Table of contents`를 작성해주면 됩니다.\n\n<br />\n<br />\n\n---\n\n## 최종 코드\n\n```ts:libs/mdx.ts\nimport { serialize } from 'next-mdx-remote/serialize';\nimport rehypeAutolinkHeadings from 'rehype-autolink-headings';\nimport rehypeCodeTitles from 'rehype-code-titles';\nimport rehypePrism from 'rehype-prism-plus';\nimport rehypeSlug from 'rehype-slug';\nimport remarkGfm from 'remark-gfm';\nimport remarkToc from 'remark-toc';\n\nexport const serializeMdx = (source: string) => {\n  return serialize(source, {\n    parseFrontmatter: true,\n    mdxOptions: {\n      remarkPlugins: [remarkToc, remarkGfm],\n      rehypePlugins: [\n        rehypeSlug,\n        rehypeCodeTitles,\n        rehypePrism,\n        [\n          rehypeAutolinkHeadings,\n          {\n            properties: {\n              className: ['anchor'],\n            },\n          },\n        ],\n      ],\n      format: 'mdx',\n    },\n  });\n};\n```\n\n### 참고\n\nhttps://yceffort.kr/2020/10/migrate-gatsby-from-nextjs  \nhttps://colinhemphill.com/blog/fast-static-syntax-highlighting-for-mdx-in-nextjs\n\nProject Level Snippets  \nhttps://code.visualstudio.com/updates/v1_28#_project-level-snippets\n","slug":"test/test01","readingMinutes":8,"wordCount":845}]},"__N_SSG":true}